# Changelog - Refactoring to AWS Direct Execution

## –î–∞—Ç–∞: 2025-10-19

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚ùå –£–¥–∞–ª–µ–Ω–æ
1. **SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** - –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SSH
2. **SLURM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - —É–±—Ä–∞–Ω—ã –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SLURM
3. **Paramiko** - —É–¥–∞–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è SSH
4. **SSH keys –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —É–±—Ä–∞–Ω–æ –∏–∑ docker-compose.yml
5. **Conda –æ–∫—Ä—É–∂–µ–Ω–∏–µ** - –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ Python —Å pip

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
1. **–ü—Ä—è–º–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - –≤–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤–Ω—É—Ç—Ä–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
2. **Python requests** - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ requests –≤–º–µ—Å—Ç–æ wget
3. **Subprocess execution** - task.sh –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ subprocess
4. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã README, –¥–æ–±–∞–≤–ª–µ–Ω QUICKSTART

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ

#### `server_cloud.py`
- –£–¥–∞–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏:
  - `connect_to_itmo_server()` - SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
  - `create_slurm_script()` - —Å–æ–∑–¥–∞–Ω–∏–µ SLURM —Å–∫—Ä–∏–ø—Ç–æ–≤
  - `check_job_status()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ SLURM –∑–∞–¥–∞–Ω–∏—è
  - `download_and_upload_to_s3()` - –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
  
- –ò–∑–º–µ–Ω–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏:
  - `download_image()` - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `requests` –≤–º–µ—Å—Ç–æ `wget`
  - `run_video_generation()` - –ø—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `subprocess.run()`
  - –£–¥–∞–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤–µ—Ç–≤–ª–µ–Ω–∏—è `IS_LOCAL_MODE` vs SSH
  
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
  ```python
  # –£–¥–∞–ª–µ–Ω–æ:
  - ITMO_SERVER_HOST, ITMO_SERVER_PORT, ITMO_SERVER_USERNAME
  - ITMO_SERVER_PASSWORD, ITMO_SERVER_KEY_PATH
  - IS_LOCAL_MODE, SLURM_*
  
  # –î–æ–±–∞–≤–ª–µ–Ω–æ/–∏–∑–º–µ–Ω–µ–Ω–æ:
  - SCRIPT_PATH (–ø—É—Ç—å –∫ task.sh)
  ```

#### `task.sh`
- –£–¥–∞–ª–µ–Ω–æ:
  - –í—Å–µ –±–ª–æ–∫–∏ —Å Conda (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, —Å–æ–∑–¥–∞–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∞–∫—Ç–∏–≤–∞—Ü–∏—è)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ torch —á–µ—Ä–µ–∑ conda
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ requirements.txt
  - SLURM —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  
- –ò–∑–º–µ–Ω–µ–Ω–æ:
  - –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Python –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `python3 video_generate.py` –∏–∑ `/app/SkyReels-V1`
  - –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏ (‚úÖ/‚ùå)
  
#### `Dockerfile`
- –£–¥–∞–ª–µ–Ω–æ:
  - `openssh-client` - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω SSH
  - SSH –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `/root/.ssh`
  - `paramiko` —É—Å—Ç–∞–Ω–æ–≤–∫–∞
  
- –î–æ–±–∞–≤–ª–µ–Ω–æ:
  - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `SkyReels-V1/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ `SkyReels-V1/requirements.txt`
  - –°–¥–µ–ª–∞—Ç—å `task.sh` –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º

#### `docker-compose.yml`
- –£–¥–∞–ª–µ–Ω–æ:
  - –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `/usr/bin/sbatch`, `/usr/bin/squeue`, `/usr/bin/sacct`
  - –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `./ssh_keys:/root/.ssh`
  - `PUBLIC_VIDEOS_DIR` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - `ITMO_SERVER_*` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  
- –ò–∑–º–µ–Ω–µ–Ω–æ:
  - `CUDA_VISIBLE_DEVICES` —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `.env` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)
  - –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ volumes

#### `requirements.txt`
- –£–¥–∞–ª–µ–Ω–æ:
  - `paramiko>=2.7.0`

#### `README.md`
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è AWS EC2 + Direct Execution –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è Architecture
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã API
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è Troubleshooting
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Performance

#### `setup.sh`
- –£–¥–∞–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è SSH –∫–ª—é—á–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `.env` —Ñ–∞–π–ª–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ NVIDIA Container Toolkit
- –£–ª—É—á—à–µ–Ω–Ω—ã–π UI —Å —Ü–≤–µ—Ç–∞–º–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—ã–≤–æ–¥–æ–º

## –ù–æ–≤—ã–π Workflow

### –°—Ç–∞—Ä—ã–π (—á–µ—Ä–µ–∑ SLURM):
```
Client ‚Üí API ‚Üí SSH ‚Üí SLURM ‚Üí Queue ‚Üí Conda Env ‚Üí Generate ‚Üí Check Status ‚Üí Download ‚Üí S3
```

### –ù–æ–≤—ã–π (–ø—Ä—è–º–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ):
```
Client ‚Üí API ‚Üí Queue ‚Üí Download Image ‚Üí Generate (local) ‚Üí S3 Upload ‚Üí Return URL
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

1. **–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å** –Ω–∞ `/run` —Å `image_url` –∏ `prompt`
2. **–ó–∞–ø—Ä–æ—Å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å** (threading.Queue) –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. **–í–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á—É**:
   - –°–∫–∞—á–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Python `requests`
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç `task.sh` —á–µ—Ä–µ–∑ `subprocess.run()` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. **task.sh –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è**:
   - –°–æ–∑–¥–∞–µ—Ç –≤—ã—Ö–æ–¥–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç `SkyReels-V1/video_generate.py`
   - –°–æ–∑–¥–∞–µ—Ç `status.json` —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
5. **–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**:
   - –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ S3 –Ω–∞–ø—Ä—è–º—É—é
   - –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ "done" —Å URL S3
6. **–ö–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å** —á–µ—Ä–µ–∑ `/status` –∏ –ø–æ–ª—É—á–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é

### AWS EC2:
- –ò–Ω—Å—Ç–∞–Ω—Å —Å GPU (g5.xlarge, g5.2xlarge, p3.2xlarge –∏ —Ç.–¥.)
- NVIDIA Container Toolkit —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- Docker & Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

### GPU:
- –ú–∏–Ω–∏–º—É–º 12GB VRAM (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 16GB+)
- CUDA 12.1 compatible

### S3:
- Bucket —Å–æ–∑–¥–∞–Ω
- IAM —Ä–æ–ª—å –∏–ª–∏ –∫–ª—é—á–∏ —Å –ø—Ä–∞–≤–∞–º–∏ `s3:PutObject`

## –ú–∏–≥—Ä–∞—Ü–∏—è

–ï—Å–ª–∏ —É –≤–∞—Å –±—ã–ª –∑–∞–ø—É—â–µ–Ω —Å—Ç–∞—Ä—ã–π –∫–æ–¥:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose down

# 2. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥
git pull

# 3. –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª (—Å–º. QUICKSTART.md)

# 4. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
./setup.sh
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# 1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
docker-compose ps

# 2. GPU –¥–æ—Å—Ç—É–ø–µ–Ω
docker exec -it video-generation-api nvidia-smi

# 3. API –æ—Ç–≤–µ—á–∞–µ—Ç
curl http://localhost:8000/processes

# 4. –¢–µ—Å—Ç–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (—Å–º. QUICKSTART.md)
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–û—á–µ—Ä–µ–¥—å –≤ –ø–∞–º—è—Ç–∏** - –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ—á–µ—Ä–µ–¥—å —Ç–µ—Ä—è–µ—Ç—Å—è
2. **–°—Ç–∞—Ç—É—Å—ã –≤ –ø–∞–º—è—Ç–∏** - –Ω–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
3. **–û–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –∑–∞ —Ä–∞–∑** - –æ—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
4. **Timeout 1 —á–∞—Å** - –µ—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1 —á–∞—Å, –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] Redis/PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- [ ] Celery –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [ ] WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞
- [ ] Health check endpoint
- [ ] Metrics (Prometheus)
- [ ] Multiple GPU support

